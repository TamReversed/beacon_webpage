<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Dashboard ‚Äì Beacon</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='20' fill='%230EA5E9'/><circle cx='50' cy='50' r='30' fill='none' stroke='%230EA5E9' stroke-width='2' opacity='0.6'/><circle cx='50' cy='50' r='40' fill='none' stroke='%230EA5E9' stroke-width='2' opacity='0.3'/></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Geist:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/styles.css">
</head>
<body class="inner-page">
    <a href="#main" class="skip-link">Skip to main content</a>
    <nav id="navbar" class="nav" aria-label="Main">
        <div class="container">
            <a href="/" class="logo">
                <svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="50" cy="50" r="20" fill="currentColor"/>
                    <circle cx="50" cy="50" r="30" stroke="currentColor" stroke-width="2" opacity="0.6" fill="none"/>
                    <circle cx="50" cy="50" r="40" stroke="currentColor" stroke-width="2" opacity="0.3" fill="none"/>
                </svg>
                Beacon
            </a>
            <div class="nav-panel" id="nav-panel" role="dialog" aria-label="Navigation">
                <ul class="nav-links">
                    <li><a href="/features">Features</a></li>
                    <li><a href="/pricing">Pricing</a></li>
                    <li><a href="/docs">Docs</a></li>
                    <li><a href="/blog">Blog</a></li>
                </ul>
                <div class="nav-actions">
                    <a href="/login">Log In</a>
                    <a href="/register" class="btn btn-primary">Get Started Free</a>
                </div>
            </div>
            <button class="hamburger" type="button" aria-label="Open menu" aria-expanded="false" aria-controls="nav-panel"><span></span><span></span><span></span></button>
        </div>
    </nav>

    <header class="page-header">
        <div class="container">
            <h1>Dashboard</h1>
            <p id="dashboard-welcome">Loading‚Ä¶</p>
        </div>
    </header>

    <div class="page-content" id="main">
        <div class="container container--narrow">
            <div id="dashboard-plan-badge" class="dashboard-badge"></div>
            <p>You‚Äôre logged in. Use the <a href="/library">Document Library</a> to browse and download documents.</p>
            <div id="dashboard-full-access" class="dashboard-full-access">
                <h3>Full access (Pro)</h3>
                <p>Your account has full access: all features, unlimited status pages, API, custom domain, and priority support. You can use everything Beacon offers.</p>
            </div>

            <section class="dashboard-idea-section">
                <h2>Submit an idea</h2>
                <p>Suggest an improvement. We review all submissions.</p>
                <form id="dashboard-idea-form" class="dashboard-idea-form">
                    <label>Title
                        <input type="text" id="idea-title" required placeholder="Short title" />
                    </label>
                    <label>Description (optional)
                        <textarea id="idea-description" placeholder="Describe your idea" rows="3"></textarea>
                    </label>
                    <button type="submit" class="btn btn-primary" id="idea-submit-btn">Submit idea</button>
                </form>
            </section>

            <section class="my-ideas-section">
                <h2>My ideas</h2>
                <p id="my-ideas-status">Loading‚Ä¶</p>
                <ul id="my-ideas-list"></ul>
            </section>

            <p class="page-actions"><a href="/library" class="btn btn-outline">Document Library</a> <a href="/" class="btn btn-outline">Back to home</a></p>
        </div>
    </div>

    <footer class="footer" role="contentinfo">
        <div class="container">
            <div class="footer-bottom" style="padding-top: 0; border: none;">
                <div>&copy; 2026 Beacon. All rights reserved.</div>
                <div class="social-links">
                    <a href="https://twitter.com/beacon" aria-label="Twitter">ùïè</a>
                    <a href="https://github.com/beacon" aria-label="GitHub"><svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/></svg></a>
                    <a href="https://linkedin.com/company/beacon" aria-label="LinkedIn">in</a>
                </div>
            </div>
        </div>
    </footer>
    <script src="/auth-nav.js"></script>
    <script src="/main.js"></script>
    <script>
      (function () {
        var welcome = document.getElementById('dashboard-welcome');
        fetch('/api/me', { credentials: 'include' })
          .then(function (res) {
            if (res.status === 401) {
              window.location.href = '/login?next=/dashboard';
              return;
            }
            return res.json();
          })
          .then(function (data) {
            if (data && data.user) {
              welcome.textContent = 'Welcome, ' + (data.user.name || data.user.email) + '.';
              var plan = data.user.plan || 'free';
              var role = data.user.role || 'user';
              var badge = document.getElementById('dashboard-plan-badge');
              var fullAccess = document.getElementById('dashboard-full-access');
              if (plan === 'pro' || role === 'admin') {
                if (badge) {
                  badge.style.display = 'block';
                  badge.textContent = 'Pro account ¬∑ Full access';
                }
                if (fullAccess) fullAccess.style.display = 'block';
              } else if (plan !== 'free' && badge) {
                badge.style.display = 'block';
                badge.textContent = 'Plan: ' + plan;
              }
            } else {
              welcome.textContent = 'Welcome to Beacon.';
            }
          })
          .catch(function () {
            welcome.textContent = 'Welcome to Beacon.';
          });

        function loadMyIdeas() {
          var statusEl = document.getElementById('my-ideas-status');
          var listEl = document.getElementById('my-ideas-list');
          if (!statusEl || !listEl) return;
          fetch('/api/ideas', { credentials: 'include' })
            .then(function (r) { return r.ok ? r.json() : null; })
            .then(function (data) {
              var ideas = (data && data.ideas) ? data.ideas : [];
              statusEl.textContent = ideas.length === 0 ? 'You haven‚Äôt submitted any ideas yet.' : '';
              while (listEl.firstChild) listEl.removeChild(listEl.firstChild);
              ideas.forEach(function (idea) {
                var li = document.createElement('li');
                li.className = 'idea-item';
                var strong = document.createElement('strong');
                strong.textContent = idea.title || 'Untitled';
                li.appendChild(strong);
                var statusSpan = document.createElement('span');
                statusSpan.className = 'idea-status-pill ' + (idea.status || 'pending');
                statusSpan.textContent = idea.status === 'approved' ? 'Approved' : idea.status === 'rejected' ? 'Rejected' : 'Pending';
                li.appendChild(statusSpan);
                if (idea.description) {
                  var p = document.createElement('p');
                  p.textContent = idea.description;
                  li.appendChild(p);
                }
                listEl.appendChild(li);
              });
            })
            .catch(function () {
              statusEl.textContent = 'Could not load your ideas.';
            });
        }

        document.getElementById('dashboard-idea-form').addEventListener('submit', function (e) {
          e.preventDefault();
          var titleEl = document.getElementById('idea-title');
          var descEl = document.getElementById('idea-description');
          var btn = document.getElementById('idea-submit-btn');
          if (!titleEl || !btn) return;
          btn.disabled = true;
          fetch('/api/ideas', {
            method: 'POST',
            credentials: 'include',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ title: titleEl.value.trim(), description: (descEl && descEl.value) ? descEl.value.trim() : '' }),
          })
            .then(function (r) {
              if (!r.ok) return r.json().then(function (d) { throw new Error(d.error || 'Failed to submit'); });
              return r.json();
            })
            .then(function () {
              titleEl.value = '';
              if (descEl) descEl.value = '';
              loadMyIdeas();
            })
            .catch(function (err) {
              alert(err.message || 'Failed to submit idea');
            })
            .finally(function () {
              btn.disabled = false;
            });
        });

        loadMyIdeas();
      })();
    </script>
</body>
</html>
