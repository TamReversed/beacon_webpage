<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Document Library ‚Äì ArgusPage</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='20' fill='%230EA5E9'/><circle cx='50' cy='50' r='30' fill='none' stroke='%230EA5E9' stroke-width='2' opacity='0.6'/><circle cx='50' cy='50' r='40' fill='none' stroke='%230EA5E9' stroke-width='2' opacity='0.3'/></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Geist:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/styles.css">
</head>
<body class="inner-page">
    <a href="#main" class="skip-link">Skip to main content</a>
    <nav id="navbar" class="nav" aria-label="Main">
        <div class="container">
            <a href="/" class="logo">
                <svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="50" cy="50" r="20" fill="currentColor"/>
                    <circle cx="50" cy="50" r="30" stroke="currentColor" stroke-width="2" opacity="0.6" fill="none"/>
                    <circle cx="50" cy="50" r="40" stroke="currentColor" stroke-width="2" opacity="0.3" fill="none"/>
                </svg>
                ArgusPage
            </a>
            <div class="nav-panel" id="nav-panel" role="dialog" aria-label="Navigation">
                <ul class="nav-links">
                    <li><a href="/features">Features</a></li>
                    <li><a href="/pricing">Pricing</a></li>
                    <li><a href="/docs">Docs</a></li>
                    <li><a href="/blog">Blog</a></li>
                </ul>
                <div class="nav-actions">
                    <a href="/login">Log In</a>
                    <a href="/register" class="btn btn-primary">Get Started Free</a>
                </div>
            </div>
            <button class="hamburger" type="button" aria-label="Open menu" aria-expanded="false" aria-controls="nav-panel"><span></span><span></span><span></span></button>
        </div>
    </nav>

    <header class="page-header page-header--hero">
        <div class="page-header-bg" aria-hidden="true">
            <div class="page-header-mesh" id="page-header-mesh"></div>
            <div class="page-header-grid" id="page-header-grid"></div>
            <div class="page-header-orb page-header-orb--1"></div>
            <div class="page-header-orb page-header-orb--2"></div>
            <div class="page-header-orb page-header-orb--3"></div>
        </div>
        <div class="container">
            <h1>Document Library</h1>
            <p>View or download your team's documents in one place.</p>
        </div>
    </header>

    <div class="page-content" id="main">
        <div class="container">
            <div class="section-header library-intro">
                <h2>Your documents</h2>
                <p>View or download files below. Have an idea for improvement? <a href="/dashboard">Submit it on your dashboard</a>.</p>
            </div>
            <div id="library-list" class="library-list">
                <p id="library-status" class="library-status">Loading‚Ä¶</p>
                <ul id="library-docs" class="library-docs"></ul>
            </div>
            <p class="page-actions"><a href="/dashboard" class="btn btn-outline">‚Üê Back to Dashboard</a></p>
        </div>
    </div>

    <div id="library-viewer" class="library-viewer" role="dialog" aria-modal="true" aria-labelledby="library-viewer-title" hidden>
        <div class="library-viewer-backdrop" id="library-viewer-backdrop"></div>
        <div class="library-viewer-panel">
            <div class="library-viewer-header">
                <h2 id="library-viewer-title" class="library-viewer-title">Document</h2>
                <div class="library-viewer-actions">
                    <a id="library-viewer-download" class="btn btn-outline btn-sm" href="#" download style="display: none;">Download</a>
                    <button type="button" class="btn btn-ghost btn-sm library-viewer-close" id="library-viewer-close" aria-label="Close viewer">Close</button>
                </div>
            </div>
            <div class="library-viewer-body">
                <iframe id="library-viewer-iframe" title="Document content"></iframe>
            </div>
        </div>
    </div>

    <footer class="footer" role="contentinfo">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-column">
                    <h4>Product</h4>
                    <ul class="footer-links">
                        <li><a href="/features">Features</a></li>
                        <li><a href="/pricing">Pricing</a></li>
                        <li><a href="/docs">Docs</a></li>
                        <li><a href="/api">API Reference</a></li>
                        <li><a href="/changelog">Changelog</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h4>Company</h4>
                    <ul class="footer-links">
                        <li><a href="/about">About</a></li>
                        <li><a href="/blog">Blog</a></li>
                        <li><a href="/careers">Careers</a></li>
                        <li><a href="/contact">Contact</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h4>Legal</h4>
                    <ul class="footer-links">
                        <li><a href="/privacy">Privacy Policy</a></li>
                        <li><a href="/terms">Terms of Service</a></li>
                        <li><a href="/sla">SLA</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h4>Status</h4>
                    <ul class="footer-links">
                        <li><a href="https://status.arguspage.example">ArgusPage Status</a></li>
                        <li class="footer-note">We eat our own dogfood</li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <div>&copy; 2026 ArgusPage. All rights reserved.</div>
                <div class="social-links">
                    <a href="https://twitter.com/arguspage" aria-label="Twitter">ùïè</a>
                    <a href="https://github.com/arguspage" aria-label="GitHub">
                        <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
                        </svg>
                    </a>
                    <a href="https://linkedin.com/company/arguspage" aria-label="LinkedIn">in</a>
                </div>
            </div>
        </div>
    </footer>
    <script src="/auth-nav.js"></script>
    <script src="/main.js"></script>
    <script>
      (function () {
        var statusEl = document.getElementById('library-status');
        var listEl = document.getElementById('library-docs');

        fetch('/api/me', { credentials: 'include' })
          .then(function (res) {
            if (res.status === 401) {
              window.location.href = '/login?next=' + encodeURIComponent('/library');
              return null;
            }
            return res.json();
          })
          .then(function (meData) {
            if (!meData) return;
            return fetch('/api/documents', { credentials: 'include' });
          })
          .then(function (res) {
            if (!res || !res.ok) return;
            return res.json();
          })
          .then(function (data) {
            if (!data) return;
            var docs = data.documents || [];
            statusEl.textContent = '';
            if (docs.length === 0) {
              statusEl.textContent = 'No documents yet.';
              return;
            }
            docs.forEach(function (doc) {
              var li = document.createElement('li');
              li.className = 'library-doc-item';
              var title = document.createElement('strong');
              title.textContent = doc.title || doc.original_name || 'Untitled';
              li.appendChild(title);
              if (doc.description) {
                var desc = document.createElement('p');
                desc.textContent = doc.description;
                li.appendChild(desc);
              }
              var actions = document.createElement('div');
              actions.className = 'library-doc-actions';
              var viewBtn = document.createElement('button');
              viewBtn.type = 'button';
              viewBtn.className = 'btn btn-primary btn-sm';
              viewBtn.textContent = 'View';
              viewBtn.setAttribute('data-doc-id', String(doc.id));
              viewBtn.setAttribute('data-doc-title', doc.title || doc.original_name || 'Untitled');
              viewBtn.setAttribute('data-doc-view-url', '/api/documents/' + doc.id + '/view');
              viewBtn.setAttribute('data-doc-download-url', '/api/documents/' + doc.id + '/download');
              viewBtn.setAttribute('data-doc-filename', doc.original_name || '');
              actions.appendChild(viewBtn);
              var downloadLink = document.createElement('a');
              downloadLink.href = '/api/documents/' + doc.id + '/download';
              downloadLink.setAttribute('download', doc.original_name || '');
              downloadLink.className = 'btn btn-outline btn-sm';
              downloadLink.textContent = 'Download';
              actions.appendChild(downloadLink);
              li.appendChild(actions);
              listEl.appendChild(li);
            });
          })
          .catch(function () {
            statusEl.textContent = 'Could not load documents. Please try again.';
          });

        var viewer = document.getElementById('library-viewer');
        var viewerIframe = document.getElementById('library-viewer-iframe');
        var viewerTitle = document.getElementById('library-viewer-title');
        var viewerDownload = document.getElementById('library-viewer-download');
        var viewerClose = document.getElementById('library-viewer-close');
        var viewerBackdrop = document.getElementById('library-viewer-backdrop');

        function openViewer(viewUrl, title, downloadUrl, filename) {
          viewerTitle.textContent = title;
          viewerIframe.src = viewUrl;
          viewerDownload.href = downloadUrl;
          viewerDownload.download = filename || '';
          viewerDownload.style.display = downloadUrl ? 'inline-flex' : 'none';
          viewer.hidden = false;
          document.body.style.overflow = 'hidden';
          viewerClose.focus();
        }

        function closeViewer() {
          viewer.hidden = true;
          viewerIframe.src = 'about:blank';
          document.body.style.overflow = '';
        }

        listEl.addEventListener('click', function (e) {
          var btn = e.target.closest('button[data-doc-id]');
          if (!btn) return;
          var id = btn.getAttribute('data-doc-id');
          var title = btn.getAttribute('data-doc-title');
          var viewUrl = btn.getAttribute('data-doc-view-url');
          var downloadUrl = btn.getAttribute('data-doc-download-url');
          var filename = btn.getAttribute('data-doc-filename');
          if (viewUrl) openViewer(viewUrl, title, downloadUrl, filename);
        });

        if (viewerClose) viewerClose.addEventListener('click', closeViewer);
        if (viewerBackdrop) viewerBackdrop.addEventListener('click', closeViewer);
        document.addEventListener('keydown', function (e) {
          if (e.key === 'Escape' && viewer && !viewer.hidden) closeViewer();
        });
      })();
    </script>
    <script src="/footer-render.js"></script>
</body>
</html>
